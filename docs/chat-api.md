# 聊天接口文档

## 问答接口

### 请求信息
- 请求路径：`/api/chat/answer`
- 请求方法：POST
- 请求头：
  - Content-Type: application/json

### 请求参数
```json
{
    "question": "string",  // 用户问题
    "userId": "number"     // 用户ID（可选）
}
```

### 响应参数
```json
{
    "answer": "string"     // 回答内容
}
```

### 示例

#### 请求示例
```json
{
    "question": "这个产品怎么用？",
    "userId": 123
}
```

#### 响应示例
```json
{
    "answer": "根据产品说明书，使用步骤如下：1. ..."
}
```

## 实现说明

### 问答流程
1. 意图识别
   - 系统首先判断用户问题是否与产品相关
   - 如果是普通闲聊问题，直接返回大模型回答
   - 如果是产品相关问题，进入RAG检索流程

2. RAG检索流程
   - 向量检索：查找语义相似的问答对（top5，相似度阈值1.8）
   - 全文检索：查找关键词匹配的问答对（top5，相似度阈值1.8）
   - 合并结果：去重并保持顺序
   - 构建上下文：将检索结果组织成问答对格式
   - 生成答案：将上下文和问题发送给大模型生成最终答案

### 注意事项
1. 向量检索和全文检索使用不同的相似度计算方式
2. 检索结果需要达到相似度阈值才会被采用
3. 最终答案的生成会考虑检索到的所有相关上下文 